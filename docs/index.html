<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Receiver · Dev Overlay</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <style>
    html,body,a-scene{width:100%;height:100%;margin:0;background:#000}
    #hud{position:fixed;top:10px;left:10px;color:#fff;font:14px/1.4 system-ui;z-index:10}
    #hud code{background:#111;padding:2px 6px;border-radius:6px}
    video{display:none}
  </style>
</head>
<body>
  <div id="hud">
    Receiver ID: <code id="rid">gerando…</code><br>
    Abra o <b>Sender</b> e informe esse ID.
  </div>

  <a-scene
    embedded
    renderer="alpha:true; colorManagement:true"
    xr-mode="ar"
    vr-mode-ui="enabled:true"
    webxr="optionalFeatures: hit-test, dom-overlay"
    dev-overlay
  >
    <a-assets>
      <video id="remoteVideo" autoplay muted playsinline crossorigin="anonymous"></video>
      <video id="passVideo"  autoplay muted playsinline crossorigin="anonymous"></video>
    </a-assets>

    <a-entity camera position="0 1.6 0"></a-entity>
  </a-scene>

  <!-- seu componente -->
  <script src="dev-overlay.js"></script>

  <script>
    const peer = new Peer(undefined, { debug: 2 }); // PeerJS Cloud
    const ridEl = document.getElementById('rid');
    const remoteVideo = document.getElementById('remoteVideo');

    peer.on('open', id => {
      console.log('[receiver] peer open', id);
      ridEl.textContent = id;
    });

    peer.on('call', call => {
      console.log('[receiver] call received from', call.peer);
      call.answer(null); // não enviamos mídia local
      call.on('stream', stream => {
        console.log('[receiver] remote stream received', stream);
        remoteVideo.srcObject = stream;
        remoteVideo.onloadedmetadata = () => {
          console.log('[receiver] remoteVideo loadedmetadata, playing');
          remoteVideo.play();
        };
      });
      call.on('error', e => console.warn('[receiver] call error', e));
      call.on('close', () => console.log('[receiver] call closed'));
    });

    peer.on('error', e => console.warn('[receiver] peer error', e));
  </script>
</body>
</html>
